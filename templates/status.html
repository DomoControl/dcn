{% extends "template.html"  %}
{% block content %}
<h2>{{_('Status page')}}</h2>


<script type=text/javascript>
    A = {} //Dict with all other data
    B={}
    window.setInterval(function(){
            A_len = Object.keys(B).length
            $.getJSON('/getStatus', { A_len:A_len
        },
        
        function(data) {
            //~ alert(JSON.stringify(data))
            P = data.resultP; //Dict with Program data
            A = data.resultA; //Dict with all other informations
            t = '';
            
            //Header
            var f = '<table class="table table-condensed">';
            
            for( var p in P ){
                //First program row                
                f += '<tr  class="active"><td colspan=8 class="text-center">';
                f += '<span style="margin: 0 10px 0 10px;"><small>ID: </small><b>'+P[p]['id']+'</b></span>';
                f += '<span style="margin: 0 10px 0 10px;"><small>Name: </small><b>'+P[p]['name']+'</b></span>';
                f += '<span style="margin: 0 10px 0 10px;"><small>Description: </small><b>'+P[p]['description']+'</b></span>'
                f += '<span style="margin: 0 10px 0 10px;"><small>Type: </small><b>'+A['program_type'][P[p]['type_id']]['name']+'</b></span>';
                f += '</td></tr>'
                
                
                //~ t = JSON.stringify(P[p])
                //Program data
                f += '<tr><th class="text-center"><abbr title="'+A['board_io'][P[p]['in_id']]['description']+'">'+A['board_io'][P[p]['in_id']]['name']+'</abbr></th>';
                f += '<th class="text-center">Timer</th><th class="text-center"><abbr title="'+A['board_io'][P[p]['out_id']]['description']+'">'+A['board_io'][P[p]['out_id']]['name']+'</abbr></th><th class="text-center">Inverted</th></tr>'
                
                var board_id = A['board_io'][P[p]['in_id']]['board_id']
                var board_type_id = A['board'][board_id]['board_type_id']
                
                if( board_type_id == 1 ){ //Board i2c
                    if( P[p]['IN'] == 1 ){var in_img = '<img src="static/img/in_on.png" height=40px>';}else{var in_img = '<img src="static/img/in_off.png" height=40px>';}
                }
                else if ( board_type_id == 3 ){ //Board Web
                    if( P[p]['IN'] == 1 ){var in_img = '<img src="static/img/in_push_on.png" height=40px onclick="setIN('+P[p]['id']+',0)">'} else {var in_img = '<img src="static/img/in_push_off.png" height=40px onclick="setIN('+P[p]['id']+',1)" >'}
                }
                
                if( P[p]['OUT'] == 1 ){var out_img = '<img src="static/img/out_on.png" height=50px>';}else{var out_img = '<img src="static/img/out_off.png" height=50px>';}
                
                f += '<tr><td class="text-center">'+in_img+'</td>';
                if( P[p]['TIMER'] == undefined ){timer = P[p]['timer']} else{ timer = P[p]['TIMER']; }
                f += '<td class="text-center">'+timer+'</td>';

                f += '<td class="text-center">'+out_img+'</td>';
                if( P[p]['inverted'] == 1 ){var inverted = '<span class="glyphicon glyphicon glyphicon-ok" aria-hidden="true"></span>';}else{var inverted = '<span class="glyphicon glyphicon glyphicon glyphicon-remove" aria-hidden="true"></span>';}
                f += '<td class="text-center">'+inverted+'</td>'
                
                
                f += '</tr>';
                
                
            }
            f += '</table>';
            f += '<p><input  class="btn btn-default" type="submit" value="Program Edit" onclick="ProgramEdit('+P[p]['id']+')" ></p>'
        
            
            document.getElementById('status').innerHTML = f;
            document.getElementById('test').innerHTML = t;
        
        }
        )
    
    }, 1000);

    function setIN(id,mode){
        //~ alert(id+' '+mode);
        $.getJSON('/setIN', {id:id, mode:mode}, function(test){var a = 123;}  )
    }
    
    function ProgramEdit(id){
        window.location.href = "/setup_program";
    }
    

</script>


<div id='status'></div>
<div id='test'></div>

{% endblock %}
 
