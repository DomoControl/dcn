{% extends "template.html"  %}
{% block content %}
    <h2>I/O Status</h2>


    <style type="text/css">
        .sensor {
            text-align:center;
            border:1px dotted gray;
            padding:5px;
            margin:5px;
            float:left;
            width:100px;
        }
    </style>

    <script type="text/javascript">
        $(document).ready(function(){
            namespace = '/menu_status';
            var socket = io.connect('http://' + document.domain + ':' + location.port + namespace);
            f = '';
            debug = '';
            A = {}; //Dict with all other data
            ACopy = {};

            var reloadDictA = '';
            var reloadDictIO='';

            socket.on('connect', function() {
                socket.emit('menu_status_back', {data1: 'Connect'});
            });

            socket.on('my response', function(dict) {
                area = dict.area;
                area_board_io = dict.area_board_io;
                IOVal = dict.IOVal; //Dict with input value
                board_id = dict.board_id;

                // //~ debug = JSON.stringify(IOCopy);

                // if(jQuery.isEmptyObject(ACopy) != true){
                    // A = $.extend(A, ACopy);
                // }

                // if(Object.keys(IOCopy).length>0){
                    // IO = $.extend(IO, IOCopy);
                    //~ debug = JSON.stringify('IO Cambiato');
                // }
                //~ debug = JSON.stringify(IO);

                f = '';
                debug = '';
                // debug += JSON.stringify(area_board_io[39])
                // debug += JSON.stringify(IOVal);
                // debug += Object.keys(area_board_io).length
                // debug += '<br>';
                // debug += IOVal;
                // debug += '<br>';
                // debug += board_id;
                // debug += board_id.indexOf(1);

                n = 0;
                for( var a in area){
                    f += '<div style="clear:both;"  >'+ area[a]["description"] +'</div>';
                    for( var bio in area_board_io ){
                        // f += bio;
                        // f += ' ';
                        // f += '<br>************'+ area_board_io[bio]['board_io_name'] + '*******<br>'
                        // debug += '<p>' + JSON.stringify(area_board_io[bio]) + '</p>';



                        bid = board_id.indexOf(area_board_io[bio]['board_io_board_id']);
                        board_type = area_board_io[bio]['board_io_io_type_id']
                        board_io_address = area_board_io[bio]['board_io_address'];
                        id = area_board_io[bio]['board_io_id'];

                        if(area_board_io[bio]['area_id'] == area[a]['id']) {

                            if (board_type == '4' || board_type == '5') {
                                In = IOVal[bid];
                            } else {
                                In = ((IOVal[bid] & (1 << board_io_address)) > 0) ? 1 : 0;
                            }

                            document.getElementById("name"+bio).innerHTML = area_board_io[bio]['board_io_name'];

                            if(In == 0){
                                image = '<img src="static/icon/' + area_board_io[bio]['board_io_icon_off'] +'"  style="height:40px; max-width:50px;" >';
                            } else {
                                image = '<img src="static/icon/' + area_board_io[bio]['board_io_icon_on'] +'" style="height:40px; max-width:50px;">' ;

                            }
                            document.getElementById("image"+bio).innerHTML = image;
                            document.getElementById("val"+bio).innerHTML = In;
                            f += In;
                        }
                    }
                    n++;
                }
                document.getElementById('debug').innerHTML = debug;
            });

            sendEvent = function(bid, board_id_address) {
                socket.emit('change_menu_status', [bid, board_id_address]);
            };
        });
    </script>

{% for a in A['area'] %}
    <div style="clear:both;"  >{{ A['area'][a]['description'] }}</div>

    {% for bio in A['area_board_io'] %}
        {% if A['area_board_io'][bio]['area_id'] == A['area'][a]['id'] %}
            <div style='border:1px dotted gray;' class='sensor' onClick='sendEvent([{{ bio }}, {{ A["area_board_io"][bio]["board_io_address"] }}  ])' >
                <span id='description{{bio}}'></span><span id='name{{bio}}'></span><br>
                <span id='image{{bio}}'></span><br>
                <span id='val{{bio}}'></span><br>
            </div>
        {%endif%}
    {%endfor%}
{%endfor%}


<div id="debug"></div>
<div id="status"></div>
<div id="log"></div>


{% endblock %}
