
{% extends "template.html"  %}
{% block content %}
    <h2>I/O Status</h2>




    <script type="text/javascript">
        var tmp = '123';

        $(document).ready(function(){
            namespace = '/menu_status';
            var socket = io.connect('http://' + document.domain + ':' + location.port + namespace);
            f = '';
            debug = '';
            A = {}; //Dict with all other data
            ACopy = {};

            var reloadDictA = '';
            var reloadDictIO='';

            socket.on('connect', function() {
                socket.emit('menu_status_back', {data1: 'Connect'});
            });

            socket.on('my response', function(dict) {
                area = dict.area;
                area_board_io = dict.area_board_io;
                IOVal = dict.IOVal; //Dict with input value
                board_id = dict.board_id;

                // //~ debug = JSON.stringify(IOCopy);

                // if(jQuery.isEmptyObject(ACopy) != true){
                    // A = $.extend(A, ACopy);
                // }

                // if(Object.keys(IOCopy).length>0){
                    // IO = $.extend(IO, IOCopy);
                    //~ debug = JSON.stringify('IO Cambiato');
                // }
                //~ debug = JSON.stringify(IO);

                f = '';
                debug = '';
                // debug += JSON.stringify(area_board_io[39])
                // debug += JSON.stringify(IOVal);
                // debug += Object.keys(area_board_io).length
                // debug += '<br>';
                // debug += IOVal;
                // debug += '<br>';
                // debug += board_id;
                // debug += board_id.indexOf(1);

                n = 0;
                for( var a in area){
                    f += '<div style="clear:both;"  >'+ area[a]["description"] +'</div>';
                    for( var bio in area_board_io ){
                        // f += bio;
                        // f += ' ';
                        // f += '<br>************'+ area_board_io[bio]['board_io_name'] + '*******<br>'
                        // debug += '<p>' + JSON.stringify(area_board_io[bio]) + '</p>';



                        bid = board_id.indexOf(area_board_io[bio]['board_io_board_id']);
                        board_type = area_board_io[bio]['board_io_io_type_id']
                        board_io_address = area_board_io[bio]['board_io_address'];
                        id = area_board_io[bio]['board_io_id'];

                        if(area_board_io[bio]['area_id'] == area[a]['id']) {

                            if (board_type == '4' || board_type == '5') {
                                In = IOVal[bid];
                            } else {
                                In = ((IOVal[bid] & (1 << board_io_address)) > 0) ? 1 : 0;
                            }


                            document.getElementById("name"+bio).title = area_board_io[bio]['board_io_description'];

                            document.getElementById("name"+bio).innerHTML = area_board_io[bio]['board_io_name'];


                            if(In == 0){
                                image = '<img src="static/icon/' + area_board_io[bio]['board_io_icon_off'] +'"  style="height:40px; max-width:50px;" >';
                            } else {
                                image = '<img src="static/icon/' + area_board_io[bio]['board_io_icon_on'] +'" style="height:40px; max-width:50px;">' ;

                            }
                            document.getElementById("image"+bio).innerHTML = image;
                            document.getElementById("val"+bio).innerHTML = In;
                            f += In;
                        }
                    }
                    n++;
                }
                document.getElementById('debug').innerHTML = debug;



            });

            sendEvent = function(board_io_id, board_id_address) {
                socket.emit('change_menu_status', [board_io_id, board_id_address]);
            };

            getInfo = function(board_io_id, board_id_address) {
                socket.emit('menu_status_getInfo', [board_io_id, board_id_address]);
            };

            socket.on('menu_status_getInfo' , function(dict) {
                title = dict.title;
                text = dict.text;
                document.getElementById("ms_info_title").innerHTML = title;
                document.getElementById("ms_info_text").innerHTML = text;
            });

        });
    </script>




{% for a in A['area'] %}
    <div style="clear:both;"  >{{ A['area'][a]['description'] }}</div>
    {% for board_io_id in A['area_board_io'] %}
        {% if A['area_board_io'][board_io_id]['area_id'] == A['area'][a]['id'] %}
            <div style='border:1px dotted gray;' class='sensor'  >

                <div class='ms_info'>
                    <span class='glyphicon glyphicon-question-sign' aria-hidden='true' data-toggle="modal" data-target="#ms_info" onClick='getInfo([{{ board_io_id }}, {{ A["area_board_io"][board_io_id]["board_io_address"] }} ])' > </span>
                </div>

                <span title='description{{board_io_id}}' id='name{{board_io_id}}'></span><br>

                <span id='image{{board_io_id}}' onClick='sendEvent([{{ board_io_id }}, {{ A["area_board_io"][board_io_id]["board_io_address"] }}  ])'></span><br>

                <span id='val{{board_io_id}}'></span><br>

            </div>
        {%endif%}
    {%endfor%}
{%endfor%}


<div id="debug"></div>
<div id="status"></div>
<div id="log"></div>

<!-- Modal -->
<div id="ms_info" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title" id="ms_info_title"></h4>
      </div>
      <div class="modal-body">
        <p id="ms_info_text"></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>


{% endblock %}
